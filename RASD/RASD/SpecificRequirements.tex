\subsection{External interfaces requirements}

\subsubsection{User interfaces}
\paragraph{\ac{eMSP}}
The \ac{eMSP} should be accessible through an application installed on the mobile device.
The first interface shown to the user, if not already done, is the \textit{login} page where the user has to input the email and password in order to authenticate.
From the \textit{login} page there is also the possibility to go to the \textit{sign up} page where the fields for inserting the necessary information are shown.
After logging in, there are multiple tabs in the app, which are:
\begin{itemize}
    \item A satellite map of the charging stations near user's position;
    \item A personalizable ranked list based on parameters chosen by the user (distance, price, environmental friendliness\ldots).
    \item A screen for enabling/disabling suggestions from the system and for setting up the connection to the user web calendar.
\end{itemize}
By selecting a station (from the ranked list or the satellite map) the specific information about it are shown. The user can select the date and the time slot from the available ones.

A \ac{CPO} can register to the system with a special form providing Company name, password and \gls{partita IVA}. Once the \ac{CPO} is registered and logged in, he can insert/remove the \ac{API} reference to the interface of a \ac{CPMS}.

\paragraph{\ac{CPMS}}
The \ac{CPMS} works as a web application; When a \ac{CPO}maintainer logs in he has the possibility to handle all the added stations.\\
In particular he can view: the system status, the list of charging stations and their policy, the available sockets and the \ac{SoC} of batteries.\\
The \ac{CPO}maintainers can change the policy of each charging station; in particular they can:
\begin{itemize}
    \item Choose a the energy provider from a list of \acp{DSO};
    \item Choose to use only the energy stored in the batteries and, once discharged, to go into automatic mode;
    \item Choose the automatic mode, that will pick autonomously which \ac{DSO} to use, whether to use batteries and when to recharge them;
\end{itemize}

The \ac{CPO} can also view the price of his service and set the revenue percentage for a single charge. Finally, the \ac{CPO} can also create some special offers.

\subsubsection{Hardware interfaces}
\paragraph{\ac{eMSP}}
The user, in order to interact with the \ac{eMSP}, must have a device that is provided with a \ac{GPS} and internet connection. Thanks to this, the user can search for close charging stations, see if those are available and can book or cancel a charge.
A Bluetooth peripheral should also be available to the user when he is in the vehicle, in order to make a connection with it. Thanks to this the device can query the vehicle infos (such as average battery consumption per kilometer, estimated autonomy and \ac{SoC}) so that the system can suggest to the user when and where to charge the vehicle.

\paragraph{\ac{CPMS}}
In order to use the \ac{CPMS}, the \ac{CPO}maintainer (the only type of user of this system) should have a personal computer with internet connection available so that it's possible to see the system info and communicate changes to the system (i.e. change the energy source of a charging station or setting the new revenue for a charge).

\subsubsection{Software interfaces}
\paragraph{\ac{eMSP}}
In order to provide all the functionalities, the \ac{eMSP} should provide the following software interfaces:
\begin{itemize}
    \item Register to the \ac{eMSP} as a user providing name, email, password, birthday, payment info;
    \item Register to the \ac{eMSP} as a \ac{CPO} providing name, email, password, \gls{partita IVA};
    \item Confirm the registration of a given user;
    \item Login to the \ac{eMSP} providing correct email and password;
    \item Retrieving data about charging stations, such as the nearest (providing a location), the cheapest or a list of K charging stations;
    \item Book a charge providing charging station, time slot and type of charge;
    \item Cancel an already booked charge;
    \item Paying a charge with the already set payment method;
    \item A \ac{CPO} can add a \ac{CPMS} providing a link to its \ac{API} interface;
\end{itemize}

\paragraph{\ac{CPMS}}
The \ac{CPMS} should provide to the external world interfaces for:
\begin{itemize}
    \item Login to the \ac{CPMS} providing an ID and a password;
    \item Enable a charge on a charging station, passing the ID (a PIN in order to authorize the charge once the user gets in the station), the station and the time slot;
    \item Get information of a particular charging station (location, price of the charge, parameter of environmental friendliness, type of charges available);
    \item Get the availability state of a particular socket;
    \item Get the future availability of the sockets managed by the system;
\end{itemize}

\subsubsection{Communication interfaces}
\paragraph{\ac{eMSP}}
The \ac{eMSP} should use internet connection in order to interact with the back-end of the system, query the different \acp{CPMS} and be connected to the electronic calendar. In order to communicate with the vehicle the user device should also be provided with bluetooth so that can retrieve data from the vehicle and use that for suggesting when and where to charge the vehicle.

\paragraph{\ac{CPMS}}
The \ac{eMSP} should be provided with a local connection in order to link all the infrastructure and make it manageable by a user in the local connection.
An internet connection should also be present in order to make the system reachable by the external world; in particular it is needed for queries and external functions made by users (like booking a charge, canceling a charge, seeing what time slots are available) and in order to manage remotely the system from the \ac{CPO}maintainers.

\subsection{Functional requirements}

\begin{enumerate}[label=\textbf{R\arabic*}]
    \item The \ac{eMSP} shall allow the users to register, providing name, surname, birthday, email, password, payment method;\label{req:eMSP-user-registration}
    \item The \ac{eMSP} shall allow the user to login with email and password;\label{req:eMSP-user-login}
    \item The \ac{eMSP} shall provide information about a selected station such as types of available sockets, price for the charge, location, available time slots, parameter on environmental friendliness;\label{req:eMSP-info-station}
    \item The \ac{eMSP} shall reserve a socket in the right charging station for a user who booked a charge through the application;\label{req:eMSP-reserve-socket}
    \item The \ac{eMSP} shall allow only one user to book a socket in a particular time slot, so no booking collisions shall occur;\label{req:eMSP-no-book-collisions}
    \item The \ac{eMSP} shall allow the user to pay for a booked charge;\label{req:eMSP-payment}
    \item The \ac{eMSP} shall refund the user when a charge is canceled;\label{req:eMSP-refund}
    \item The \ac{eMSP} shall allow the user to see nearby\footnote{This parameter may be set by the user} charging stations ordered by distance, price or environmental friendliness;\label{req:eMSP-see-stations}
    \item The \ac{eMSP} shall be able to connect to a web calendar, retrieve information about the appointments and parse them;\label{req:eMSP-connect-calendar}
    \item The \ac{eMSP} shall be able to use the information about the appointments, the charging stations and the vehicle in order to proactively suggest to the user when and where to charge the vehicle;\label{req:eMSP-proactive-suggestions}
    \item The \ac{eMSP} shall notify the user when the charging process is finished;\label{req:eMSP-notification}
    \item The \ac{eMSP} shall aggregate different \acp{CPO};\label{req:eMSP-compatible}
    \item The \ac{eMSP} shall allow a \ac{CPO} to register, providing name, email, password, \gls{partita IVA};\label{req:eMSP-cpo-registration}
    \item the \ac{eMSP} shall allow to add to an already registered \ac{CPO} a \ac{CPMS}, providing its \ac{API} reference;\label{req:eMSP-add-cpms}
    \item The \ac{eMSP} shall verify the correctness of the identification data for the \acp{CPO};\label{req:eMSP-correct-cpo-info}
    \item The \ac{eMSP} shall allow the \ac{CPO} to set the wanted revenue percentage;\label{req:eMSP-set-revenue}
    \item The \ac{eMSP} shall allow the \ac{CPO} to set special offers;\label{req:eMSP-set-special-offers}
    \item The \ac{CPMS} shall be reachable by \acp{eMSP} in order to perform or cancel a booking, or query the system;\label{req:CPMS-reachable}
    \item The \ac{CPMS} shall allow the \ac{CPO}maintainer to access to the system;\label{req:CPMS-accessible}
    \item The \ac{CPMS} shall allow the \ac{CPO}maintainer to modify the information about their systems, such as adding/removing charging stations, set stations sources and create/remove maintainers;\label{req:CPMS-modify-cpo-infos}
    \item The \ac{CPMS} shall allow the \ac{CPO}maintainer to choose the energy source and strategy;\label{req:CPMS-select-source-strategy}
    \item The \ac{CPMS} shall allow the \ac{CPO}maintainer to choose manual or automatic mode;\label{req:CPMS-select-mode}
\end{enumerate}

\begin{table}[h]
    \begin{center}
        \begin{tabular}{|c||c|c|c|c|c|}
            \hline
            Requirements/Goals:                   & \ref{goal:eMSP-helps-selecting} & \ref{goal:eMSP-booking-charge} & \ref{goal:eMSP-allow-charge} & \ref{goal:CPMS-handles-charge} & \ref{goal:CPMS-manage-station} \\\hline\hline
            \ref{req:eMSP-user-registration}      & X                               & X                              & X                            &                                &                                \\\hline
            \ref{req:eMSP-user-login}             & X                               & X                              & X                            &                                &                                \\\hline
            \ref{req:eMSP-info-station}           & X                               &                                & X                            &                                &                                \\\hline
            \ref{req:eMSP-reserve-socket}         &                                 & X                              & X                            &                                &                                \\\hline
            \ref{req:eMSP-no-book-collisions}     &                                 & X                              & X                            &                                &                                \\\hline
            \ref{req:eMSP-payment}                &                                 & X                              &                              &                                &                                \\\hline
            \ref{req:eMSP-refund}                 &                                 & X                              &                              &                                &                                \\\hline
            \ref{req:eMSP-see-stations}           & X                               & X                              &                              &                                &                                \\\hline
            \ref{req:eMSP-connect-calendar}       & X                               & X                              &                              &                                &                                \\\hline
            \ref{req:eMSP-proactive-suggestions}  & X                               & X                              &                              &                                &                                \\\hline
            \ref{req:eMSP-notification}           &                                 &                                & X                            &                                &                                \\\hline
            \ref{req:eMSP-compatible}             &                                 & X                              &                              &                                &                                \\\hline
            \ref{req:eMSP-cpo-registration}       &                                 & X                              &                              & X                              &                                \\\hline
            \ref{req:eMSP-add-cpms}               &                                 & X                              &                              & X                              &                                \\\hline
            \ref{req:eMSP-correct-cpo-info}       &                                 & X                              &                              & X                              &                                \\\hline
            \ref{req:eMSP-set-revenue}            &                                 &                                &                              &                                & X                              \\\hline
            \ref{req:eMSP-set-special-offers}     &                                 &                                &                              &                                & X                              \\\hline
            \ref{req:CPMS-reachable}              & X                               & X                              & X                            & X                              &                                \\\hline
            \ref{req:CPMS-accessible}             &                                 &                                &                              & X                              & X                              \\\hline
            \ref{req:CPMS-modify-cpo-infos}       &                                 &                                &                              &                                & X                              \\\hline
            \ref{req:CPMS-select-source-strategy} &                                 &                                &                              & X                              & X                              \\\hline
            \ref{req:CPMS-select-mode}            &                                 &                                &                              & X                              & X                              \\\hline
        \end{tabular}
    \end{center}
    \caption{Linking table among goals and requirements}
\end{table}

\clearpage
\subsubsection{Use case diagrams}
\begin{figure}[!h]
    \includegraphics[keepaspectratio, width=16cm]{UseCase/UnregisteredUser.png}
    \caption{Unregistered user use case}
\end{figure}
\begin{figure}[!h]
    \includegraphics[keepaspectratio, width=16cm]{UseCase/RegisteredUser.png}
    \caption{Registered user use case}
\end{figure}
\begin{figure}[!h]
    \includegraphics[keepaspectratio, width=16cm]{UseCase/RegisteredCPO.png}
    \caption{Registered \ac{CPO}}
\end{figure}
\begin{figure}[!h]
    \includegraphics[keepaspectratio, width=16cm]{UseCase/RegisteredCPOmaintainer.png}
    \caption{Registered \ac{CPO}maintainer}
\end{figure}
\clearpage
\subsubsection{Sequence diagrams}
\begin{figure}[!h]
    \begin{center}
        \includegraphics[keepaspectratio, width=16cm]{Sequence/user-signs-up.png}
        \caption{Registration into \ac{eMall} sequence}
    \end{center}
\end{figure}
\begin{figure}[!h]
    \begin{center}
        \includegraphics[keepaspectratio, width=16cm]{Sequence/cpo-signs-up.png}
        \caption{Registration of \ac{CPO} into \ac{eMall} sequence}
    \end{center}
\end{figure}
\begin{figure}[!h]
    \begin{center}
        \includegraphics[keepaspectratio, width=16cm]{Sequence/user-logs-in.png}
        \caption{Login into \ac{eMall} sequence}
    \end{center}
\end{figure}
\begin{figure}[!h]
    \begin{center}
        \includegraphics[keepaspectratio, width=16cm]{Sequence/cpo-adds-cpms-to-emall.png}
        \caption{\ac{CPO} adds a \ac{CPMS} into eMall}
    \end{center}
\end{figure}
\begin{figure}[!h]
    \begin{center}
        \includegraphics[keepaspectratio, width=16cm]{Sequence/cpomaintainer-logs-in.png}
        \caption{\ac{CPO} maintainer logs into \ac{CPMS}}
    \end{center}
\end{figure}
\begin{figure}[!h]
    \begin{center}
        \includegraphics[keepaspectratio, width=16cm]{Sequence/user-searches-stations.png}
        \caption{Get the nearby charging stations}
    \end{center}
\end{figure}
\begin{figure}[!h]
    \begin{center}
        \includegraphics[keepaspectratio, width=16cm]{Sequence/user-books-charge.png}
        \caption{Book a charge sequence}
    \end{center}
\end{figure}
\begin{figure}[!h]
    \begin{center}
        \includegraphics[keepaspectratio, width=16cm]{Sequence/user-pays-charge.png}
        \caption{Pay a charge sequence}
    \end{center}
\end{figure}
\begin{figure}[!h]
    \begin{center}
        \includegraphics[keepaspectratio, width=16cm]{Sequence/user-charges-vehicle.png}
        \caption{Perform a charge sequence}
    \end{center}
\end{figure}
\begin{figure}[!h]
    \begin{center}
        \includegraphics[keepaspectratio, width=16cm]{Sequence/user-cancels-charge.png}
        \caption{Cancel a charge sequence}
    \end{center}
\end{figure}
\begin{figure}[!h]
    \begin{center}
        \includegraphics[keepaspectratio, width=16cm]{Sequence/user-gets-suggestions.png}
        \caption{Charging suggestions via calendar sequence}
    \end{center}
\end{figure}
\begin{figure}[!h]
    \begin{center}
        \includegraphics[keepaspectratio, width=16cm]{Sequence/cpomaintainer-adds-stations.png}
        \caption{\ac{CPO} maintainer adds stations to \ac{CPMS}}
    \end{center}
\end{figure}
\begin{figure}[!h]
    \begin{center}
        \includegraphics[keepaspectratio, width=16cm]{Sequence/cpomaintainer-manages.png}
        \caption{\ac{CPO} maintainer manages a \ac{CPMS}}
    \end{center}
\end{figure}

\clearpage
%Definition of use case diagrams, use cases and associated sequence/activity diagrams, and mapping on requirements
\subsection{Performance requirements}
The system in general needs to manage a large collection of electric car users/\acp{CPO} and it needs to supply the heaviest services (like computing the cheapest nearest stations) in a reasonable amount of time.
Because of that the system shall guarantee a baseline load of 1000000 users/\acp{CPO} still with a response time not greater than 5 seconds. To achieve the goal, the system shall be able to decentralize all the computation as much as possible,
trying to make the client responsible of the heaviest loads.\\\\
These requirements are balanced considering the actual percentage of electric vehicle users in Italy [0.56\%] (corresponds to about 330k users) and a level of confidence of 3.
\subsection{Design constraints}
From this point we consider only the user side constraints as they represent the largest share of the system use base.
\subsubsection{Standards compliance}
The system must meet the following standards:
\begin{itemize}
    \item \textbf{\ac{GDPR} law}: The system must be compliant with the current GDPR law about users privacy;
    \item \textbf{Android and iOS}: The system must be compatible with the current versions and reasonably still used previous ones of Android and iOS.
\end{itemize}
\subsubsection{Hardware limitations}
Because the user side system consists of a smartphone app, the main hardware limitation is the computational capability of a smartphone processor. Hence the
application must be compatible with a low computational capability.

\subsection{Software system attributes}
\subsubsection{Reliability}
The system shall be fail safe, while the actual service can behave slower than expected it shall be still consistent with the results.
To do so the system shall be distributed data and performance wise, allowing a scalability factor while being open for maintenance without completely experiencing downtime.
Some good techniques are \ac{RACS} and \ac{RAPS} which put the reliability very high in the architecture.
\subsubsection{Availability}
Because a period of downtime would be detrimental, eMall has to prefer the availability over the conformity of response time.
Thus the availability should be as high as possible but greater than 99.99\% and must use some techniques to avoid down time during maintenance.
\subsubsection{Security}
Because the system will handle personal data, it has to abide the \ac{GDPR} law; thus an encryption of the user's password must be adopted and the access to the user's data must be restricted only to himself.
It is important that nobody else, not even the system administrator, can access the user's data in compliance of the privacy laws.\\
\subsubsection{Maintainability}
As stated in the Reliability and Availability sections, a good pattern for the whole system would be to consider the maintenance as less invasive as possible. Thus it would not be complicated to maintain a single or a restricted amount of nodes per time. This way the users would only experience at worst slowdowns but never downtime.
\subsubsection{Portability}
The system should be as cross platform as possible to increase the maintainability over different type of platforms.
\clearpage