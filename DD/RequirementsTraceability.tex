\begin{table}[h]
    \begin{center}
        \begin{tabular}{|c||p{15.5cm}|}
            \hline
            \ref{req:eMSP-user-registration} & 
            \ref{RegistrationComponent},
            \ref{PaymentAPI},
            \ref{MailAPI},
            \ref{Timer},
            \ref{eMallModel} 
            \\
            \hline
            \ref{req:eMSP-user-login} & 
            \ref{AuthenticationComponent},
            \ref{eMallModel} 
            \\
            \hline
            \ref{req:eMSP-info-station} & 
            \ref{AuthenticationComponent},
            \ref{eMallModel},
            \ref{StationsComponent},
            \ref{CPMSAPI},
            \ref{CPMSModel}
            \\
            \hline
            \ref{req:eMSP-reserve-socket} &
            \ref{AuthenticationComponent},
            \ref{eMallModel} 
            \ref{ChargeManagerComponent},
            \ref{CPMSAPI},
            \ref{CPMSChargeManagerComponent},
            \ref{CPMSChargingStationAPI}
            \\
            \hline
            \ref{req:eMSP-no-book-collisions} &
            \ref{AuthenticationComponent},
            \ref{eMallModel},
            \ref{ChargeManagerComponent},
            \ref{CPMSAPI},
            \ref{CPMSChargeManagerComponent},
            \ref{CPMSChargingStationAPI}
            \\
            \hline
            \ref{req:eMSP-payment} &
            \ref{AuthenticationComponent},
            \ref{eMallModel},
            \ref{ChargeManagerComponent},
            \ref{MailAPI},
            \ref{PaymentAPI},
            \ref{CPMSAPI},
            \ref{CPMSChargeManagerComponent},
            \ref{CPMSChargingStationAPI}
            \\
            \hline
            \ref{req:eMSP-refund} &
            \ref{AuthenticationComponent},
            \ref{eMallModel},
            \ref{ChargeManagerComponent},
            \ref{MailAPI},
            \ref{PaymentAPI},
            \ref{CPMSChargeManagerComponent},
            \ref{CPMSChargingStationAPI}
            \\
            \hline
            \ref{req:eMSP-see-stations} &
            \ref{AuthenticationComponent},
            \ref{eMallModel},
            \ref{StationsComponent},
            \ref{CPMSAPI},
            \ref{CPMSModel}
            \\
            \hline
            \ref{req:eMSP-connect-calendar} & 
            \\
            \hline
            \ref{req:eMSP-proactive-suggestions} & 
            \\
            \hline
            \ref{req:eMSP-notification} &
            \ref{AuthenticationComponent},
            \ref{eMallModel},
            \ref{ChargeManagerComponent},
            \ref{MailAPI},
            \ref{CPMSAPI},
            \ref{CPMSChargeManagerComponent}
            \\
            \hline
            \ref{req:eMSP-compatible} &
            \ref{CPMSManagerComponent},
            \ref{CPOManagerComponent},
            \ref{CPMSAPI},
            \ref{eMallModel}
            \\
            \hline
            \ref{req:eMSP-cpo-registration} &
            \ref{RegistrationComponent},
            \ref{PaymentAPI},
            \ref{MailAPI},
            \ref{Timer},
            \ref{eMallModel}
            \\
            \hline
            \ref{req:eMSP-add-cpms} &
            \ref{AuthenticationComponent},
            \ref{eMallModel},
            \ref{CPMSManagerComponent},
            \ref{StationsComponent},
            \ref{CPMSAPI},
            \ref{CPMSModel}
            \\
            \hline
            \ref{req:eMSP-correct-cpo-info} &
            \ref{RegistrationComponent},
            \ref{PaymentAPI}
            \\
            \hline
            \ref{req:eMSP-set-revenue} &
            \ref{AuthenticationComponent},
            \ref{eMallModel},
            \ref{CPOManagerComponent}
            \\
            \hline
            \ref{req:eMSP-set-special-offers} &
            \ref{AuthenticationComponent},
            \ref{eMallModel},
            \ref{CPOManagerComponent}
            \\
            \hline
            \ref{req:CPMS-reachable} &
            \ref{CPMSAPI},
            \ref{CPMSChargeManagerComponent},
            \ref{CPMSModel}
            \\
            \hline
            \ref{req:CPMS-accessible} &
            \ref{CPMSAuthenticationComponent},
            \ref{CPMSModel}
            \\
            \hline
            \ref{req:CPMS-modify-cpo-infos} &
            \ref{CPMSAuthenticationComponent},
            \ref{CPMSModel},
            \ref{CPMSRegistrationComponent},
            \ref{CPMSStationManagerComponent},
            \ref{CPMSChargingStationAPI}
            \\
            \hline
            \ref{req:CPMS-select-mode} &
            \ref{CPMSAuthenticationComponent},
            \ref{CPMSModel},
            \ref{CPMSStationManagerComponent}
            \\
            \hline
        \end{tabular}
    \end{center}
    \caption{Requirements traceability table}
    \label{requirements-traceability-table}
\end{table}


\begin{enumerate}[label=\textbf{R\arabic*}]
    \item \textit{The \ac{eMSP} shall allow the users to register, providing name, surname, birthday, email, password, payment method}: 
    The unregistered user uses \ref{RegistrationComponent} in order to issue a registration. 
    Then the system will use the \ref{PaymentAPI} in order to confirm that the payment method is valid. 
    After the verification of parameters, a mail through the \ref{MailAPI} is sent and a timer with the \ref{Timer} component is set in order to issue a deadline for the confirmation of registration. 
    When the confirmation of registration is received, the user will be added to the \ref{eMallModel}.
    % \ref{RegistrationComponent}
    % \ref{PaymentAPI}
    % \ref{MailAPI}
    % \ref{Timer}
    % \ref{eMallModel}
    \label{req:eMSP-user-registration}
    \item \textit{The \ac{eMSP} shall allow the user to login with email and password}:
    A user, in order to log in, communicates to the \ref{AuthenticationComponent} the willing to access sending the credentials. This component will query the \ref{eMallModel} in order to verify the credentials.
    % \ref{AuthenticationComponent}
    % \ref{eMallModel}
    \label{req:eMSP-user-login}
    \item \textit{The \ac{eMSP} shall provide information about a selected station such as types of available sockets, price for the charge, location, available time slots, parameter on environmental friendliness}:
    After the user is logged in (see \ref{req:eMSP-user-login}), the user interacts with the \ref{StationsComponent} in order to retrieve through the \ref{CPMSAPI} the charging station information contained in the \ref{CPMSModel}.
    % \ref{AuthenticationComponent}
    % \ref{eMallModel}
    % \ref{StationsComponent}
    % \ref{CPMSAPI}
    % \ref{CPMSModel}
    \label{req:eMSP-info-station}
    \item \textit{The \ac{eMSP} shall reserve a socket in the right charging station for a user who booked a charge through the application}:
    After the user is logged in (see \ref{req:eMSP-user-login}), the user, in order to perform a charge, interacts with the \ref{ChargeManagerComponent} which will pass through the \ref{CPMSAPI} to interact with the \ref{CPMSChargeManagerComponent} which will inform the charging station through the \ref{CPMSChargingStationAPI}. 
    The charging station will respond to the \ref{CPMSChargingStationAPI} if the charging station selected is busy or not for that type of charge in the time frame selected. If the operation succeeds, is assured that the slot is booked for that user.
    % \ref{AuthenticationComponent}
    % \ref{eMallModel} 
    % \ref{ChargeManagerComponent}
    % \ref{CPMSAPI}
    % \ref{CPMSChargeManagerComponent}
    % \ref{CPMSChargingStationAPI}
    \label{req:eMSP-reserve-socket}
    \item \textit{The \ac{eMSP} shall allow only one user to book a socket in a particular time slot, so no booking collisions shall occur}:
    After the user is logged in (see \ref{req:eMSP-user-login}), the user, in order to perform a charge, interacts with the \ref{ChargeManagerComponent} which will pass through the \ref{CPMSAPI} to interact with the \ref{CPMSChargeManagerComponent} which will inform the charging station through the \ref{CPMSChargingStationAPI}. 
    The charging station will respond to the \ref{CPMSChargingStationAPI} if the charging station selected is busy or not for that type of charge in the time frame selected. If the operation succeeds, is assured that nobody else can book that charging socket for that time slot.
    % \ref{AuthenticationComponent}
    % \ref{eMallModel}
    % \ref{ChargeManagerComponent}
    % \ref{CPMSAPI}
    % \ref{CPMSChargeManagerComponent}
    % \ref{CPMSChargingStationAPI}
    \label{req:eMSP-no-book-collisions}
    \item \textit{The \ac{eMSP} shall allow the user to pay for a booked charge}:
    After the user is logged in (see \ref{req:eMSP-user-login}), when he is booking a charge and the \ref{CPMSChargingStationAPI} gives a positive feedback, the user can issue a payment for the charge booked. 
    So, through the \ref{ChargeManagerComponent}, the application interfaces with the \ref{PaymentAPI} to pay for the charge. If the payment is successful, then the application will communicate to the relative charging station (through the \ref{CPMSAPI} and the \ref{CPMSChargingStationAPI}) to activate the charge booked.
    After this, the system will also send a confirmation mail through the \ref{MailAPI}.
    % \ref{AuthenticationComponent}
    % \ref{eMallModel}
    % \ref{ChargeManagerComponent}
    % \ref{MailAPI}
    % \ref{PaymentAPI}
    % \ref{CPMSAPI}
    % \ref{CPMSChargeManagerComponent}
    % \ref{CPMSChargingStationAPI}
    \label{req:eMSP-payment}
    \item \textit{The \ac{eMSP} shall refund the user when a charge is canceled}:
    After the user is logged in (see \ref{req:eMSP-user-login}), when he is booking a charge and the \ref{CPMSChargingStationAPI} gives a positive feedback, the user can issue a deletion of a booked charge, getting for consequence a refund.
    So, through the \ref{ChargeManagerComponent} and the \ref{CPMSAPI}, the application interacts with the \ref{CPMSChargeManagerComponent} in order to cancel a charge. This will check for the charge existence and its owner. The deletion will go on only if the user issuing the deletion is the owner of the charge.
    After these checks the charge can be deleted informing the charging station through the \ref{CPMSChargingStationAPI} and the refund can be made (using the \ref{PaymentAPI}) if the user already payed for it.
    After this, the system will also send a confirmation mail through the \ref{MailAPI}.
    % \ref{AuthenticationComponent}
    % \ref{eMallModel}
    % \ref{ChargeManagerComponent}
    % \ref{MailAPI}
    % \ref{PaymentAPI}
    % \ref{CPMSChargeManagerComponent}
    % \ref{CPMSChargingStationAPI}
    \label{req:eMSP-refund}
    \item \textit{The \ac{eMSP} shall allow the user to see nearby\footnote{This parameter may be set by the user} charging stations ordered by distance, price or environmental friendliness}:
    After the user is logged in (see \ref{req:eMSP-user-login}), he can request infos of nearby charging stations through the \ref{StationsComponent}. This will query the \ref{CPMSModel} thanks to the \ref{CPMSAPI}. From the data retrieved, the client application can change the way this is shown to the user in order to present it as ordered by distance, price or environmental friendliness.
    % \ref{AuthenticationComponent}
    % \ref{eMallModel}
    % \ref{StationsComponent}
    % \ref{CPMSAPI}
    % \ref{CPMSModel}
    \label{req:eMSP-see-stations}
    \item \textit{The \ac{eMSP} shall be able to connect to a web calendar, retrieve information about the appointments and parse them}:
    After the user is logged in (see \ref{req:eMSP-user-login}), the user can set up the connection to his calendar in the client application. The \ac{eMSP} client application, when needed, will interact with the calendar API to retrieve the appointments of the user.
    \todo[inline]{PIDDII}
    \label{req:eMSP-connect-calendar}
    \item \textit{The \ac{eMSP} shall be able to use the information about the appointments, the charging stations and the vehicle in order to proactively suggest to the user when and where to charge the vehicle}:
    After the user is logged in (see \ref{req:eMSP-user-login}), he can enable a setting in order to proactively suggest a charge in a precise time slot. 
    The client application will perform this task querying the calendar API, the vehicle API and the \ref{CPMSModel} (through the \ref{CPMSAPI}) in order to retrieve all the data to elaborate the best time frame and location of the next charge.
    \todo[inline]{PIDDII2}
    \label{req:eMSP-proactive-suggestions}
    \item \textit{The \ac{eMSP} shall notify the user when the charging process is finished}:
    When a user with a booked charge arrives to the designated charging socket, after inserting the PIN during the booked time frame, charge status on the display of the station and, when the charge is finished, it will communicate it both on the display and to the email address of the user through the \ref{MailAPI}.
    \todo[inline]{Come fa la charging socket/station ad inviare una mail allo user? se non si interagisce indietro con il CPMS anche questo requirement non Ã¨ soddisfatto da nessun componente}
    % \ref{AuthenticationComponent}
    % \ref{eMallModel}
    % \ref{ChargeManagerComponent}
    % \ref{MailAPI}
    % \ref{CPMSAPI}
    % \ref{CPMSChargeManagerComponent}
    \label{req:eMSP-notification}
    \item \textit{The \ac{eMSP} shall aggregate different \acp{CPO}}:
    An \ac{eMSP} can interact with different \acp{CPO} thanks to the interface implemented by all the supported \acp{CPMS}. 
    So a list of all the available \acp{CPO} is available in the \ref{eMallModel} as a list of \acp{CPO} which have, as a member, a list of \acp{CPMS}. 
    The support for these \acp{CPMS} can be added through the \ref{CPMSManagerComponent} while the revenue percentage and special offers can be set through the \ref{CPOManagerComponent}. 
    Finally, the \ref{CPMSAPI} permits to interact with the \ac{CPMS}.
    % \ref{CPMSManagerComponent}
    % \ref{CPOManagerComponent}
    % \ref{CPMSAPI}
    % \ref{eMallModel}
    \label{req:eMSP-compatible}
    \item \textit{The \ac{eMSP} shall allow a \ac{CPO} to register, providing name, email, password, \ac{IBAN} and \gls{partita IVA}}: 
    The unregistered \ac{CPO} uses the \ref{RegistrationComponent} in order to issue a registration. 
    Then the system will use the \ref{PaymentAPI} in order to confirm that the \ac{IBAN} and the \gls{partita IVA} are valid. 
    After the verification of parameters, a mail through the \ref{MailAPI} is sent and a timer with the \ref{Timer} component is set in order to issue a deadline for the confirmation of registration. 
    When the confirmation of registration is received, the user will be added to the \ref{eMallModel}.
    \todo[inline]{In the runtime view the RegistrationComponent should interact with the PaymentAPI}
    % \ref{RegistrationComponent}
    % \ref{PaymentAPI}
    % \ref{MailAPI}
    % \ref{Timer}
    % \ref{eMallModel}
    \label{req:eMSP-cpo-registration}
    \item \textit{the \ac{eMSP} shall allow to add to an already registered \ac{CPO} a \ac{CPMS}, providing its \ac{API} reference}:
    After the \ac{CPO} is logged in (see \ref{req:eMSP-user-login}), he can insert a new \ac{CPMS} in the \ref{eMallModel} thanks to the \ref{CPMSManagerComponent}. After verifying that the new \ac{CPMS} is valid, the \ref{StationsComponent} is used in order to retrieve, through the \ref{CPMSAPI}, all the charging stations contained in the relative \ref{CPMSModel}.
    % \ref{AuthenticationComponent}
    % \ref{eMallModel}
    % \ref{CPMSManagerComponent}
    % \ref{StationsComponent}
    % \ref{CPMSAPI}
    % \ref{CPMSModel}
    \todo[inline]{- Add component diagram eMall link between CPMSManagerComponent and CPMSApi\\
    - change sequence in order to make the user retrieve stations and then add them
    }
    \label{req:eMSP-add-cpms}
    \item \textit{The \ac{eMSP} shall verify the correctness of the identification data for the \acp{CPO}}:
    During the registration phase of the \ac{CPO} through the \ref{RegistrationComponent}, the system uses the \ref{PaymentAPI} in order to verify the \ac{IBAN} and \gls{partita IVA}.
    \todo[inline]{Add to component diagram eMall link between RegistrationComponent and PaymentAPI}
    % \ref{RegistrationComponent}
    % \ref{PaymentAPI}
    \label{req:eMSP-correct-cpo-info}
    \item \textit{The \ac{eMSP} shall allow the \ac{CPO} to set the wanted revenue percentage}:
    After the \ac{CPO} is logged in (see \ref{req:eMSP-user-login}), he can set the wanted revenue percentage on the \ref{eMallModel} through the \ref{CPOManagerComponent}.
    % \ref{AuthenticationComponent}
    % \ref{eMallModel}
    % \ref{CPOManagerComponent}
    \label{req:eMSP-set-revenue}
    \item \textit{The \ac{eMSP} shall allow the \ac{CPO} to set special offers}:
    After the \ac{CPO} is logged in (see \ref{req:eMSP-user-login}), he can add a wanted special offer on the \ref{eMallModel} through the \ref{CPOManagerComponent}.
    % \ref{AuthenticationComponent}
    % \ref{eMallModel}
    % \ref{CPOManagerComponent}
    \label{req:eMSP-set-special-offers}
    \item \textit{The \ac{CPMS} shall be reachable by \acp{eMSP} in order to perform or cancel a booking, or query the system}:
    The \ac{eMSP} can use the \ref{CPMSAPI} in order to communicate to the \ac{CPMS} an operation. The \ref{CPMSChargeManagerComponent} manages all the booking and canceling of charges while the \ref{CPMSModel} can be accessed in order to retrieve infos on the charging stations.
    % \ref{CPMSAPI}
    % \ref{CPMSChargeManagerComponent}
    % \ref{CPMSModel}
    \label{req:CPMS-reachable}
    \item \textit{The \ac{CPMS} shall allow the \ac{CPO}maintainer to access to the system}:
    When a \ac{CPO} maintainer issues an operation, before executing it, his authentication is verified by the \ref{CPMSAuthenticationComponent} can access the system providing an identification number and a password that will be validated by the \ref{CPMSAuthenticationComponent} which will query the \ref{CPMSModel}.
    % \ref{CPMSAuthenticationComponent}
    % \ref{CPMSModel}
    \label{req:CPMS-accessible}
    \item \textit{The \ac{CPMS} shall allow the \ac{CPO}maintainer to modify the information about their systems, such as adding/removing charging stations, set stations sources and create/remove maintainers}:
    Once the \ac{CPO} maintainer is authenticated (see \ref{req:CPMS-accessible}), he can execute different operations such as adding other \ac{CPO} maintainers (through the \ref{CPMSRegistrationComponent}) or manage the charging stations (through the \ref{CPMSStationManagerComponent} and the \ref{CPMSChargingStationAPI}).
    % \ref{CPMSAuthenticationComponent}
    % \ref{CPMSModel}
    % \ref{CPMSRegistrationComponent}
    % \ref{CPMSStationManagerComponent}
    % \ref{CPMSChargingStationAPI}
    \label{req:CPMS-modify-cpo-infos}
    \item \textit{The \ac{CPMS} shall allow the \ac{CPO}maintainer to choose manual or automatic mode}:
    Once the \ac{CPO} maintainer is authenticated (see \ref{req:CPMS-accessible}), he can manage the charging stations with the manual or automatic modes through the \ref{CPMSStationManagerComponent}.
    % \ref{CPMSAuthenticationComponent}
    % \ref{CPMSModel}
    % \ref{CPMSStationManagerComponent}
    \label{req:CPMS-select-mode}
\end{enumerate}
\clearpage